<html>
<head>
  <title>AR-View</title>
  <meta name="description" content="Multiuser community tableu">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

  <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
  <!-- <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v2.1.0/dist/aframe-physics-system.min.js"></script> -->
  <script src="https://cdn.rawgit.com/ngokevin/aframe-physics-components/master/dist/aframe-physics-components.min.js"></script>
  <!-- Multiuser connection -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
  <script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js"></script>
  <script src="easyrtc/easyrtc.js"></script>

  <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.5/dist/aframe-particle-system-component.min.js"></script>

  <!-- Argon -->
  <!-- <script src="library/argon/argon.js"></script>
  <script src="library/argon/argon-aframe.js"></script>
  <script src="library/argon/CSS3DArgonRenderer.js"></script>
  <script src="library/argon/CSS3DArgonHUD.js"></script>
  <script src="library/aframe-look-at-component.js"></script> -->

  <!-- A-Frame component to register event listeners that set properties -->
  <!-- useful for cursor events -->
  <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.min.js"></script>

  <link rel="stylesheet" href="css/arview.css">
  <meta charset="UTF-8">
  <title>The Table</title>
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

  <!-- Bootstrap -->

  <script type="text/javascript">
    // Define custom schema for syncing avatar color, set by random-color
    NAF.schemas.add({
      template: '#avatar-template',
      components: [
        'position',
        'rotation',
        {
          selector: '.head',
          component: 'material',
          property: 'color'
        }
      ]
    });
  </script>
</head>
  <body onload="init()">
    <!-- <script>
      // Argon obj location detect
      AFRAME.registerComponent('showdistance', {
        schema: {
          default: ""
        },

        init: function () {
            this.text = "";
        },

        update: function () {
          this.text = this.data;
        },

        tick: function (t) {
          var object3D = this.el.parentEl.parentEl.object3D;
          var camera = this.el.sceneEl.camera;
          if (!camera) {return;}

          var cameraPos = camera.getWorldPosition();
          var thisPos = object3D.getWorldPosition();
          var distance = Math.round(thisPos.distanceTo(cameraPos));

          var cssDiv = this.el.getObject3D('div');
          var msg = this.text + distance + " meters away";
          cssDiv.elements[0].innerHTML = msg;
          cssDiv.elements[1].innerHTML = msg;
        }
      });
    </script> -->
    <!-- <div hidden>
      <div id="gtdiv" class="label">Georgia Tech</div>
      <div id="londondiv" class="label">Tower of London</div>
      <div id="tokyodiv" class="label">Tokyo</div>
      <div id="sydneydiv" class="label">Sydney Opera House</div>
      <div id="londonpin" class="pin"><i class="fa fa-map-marker" aria-hidden="true"></i></div>
      <div id="tokyopin" class="pin"><i class="fa fa-map-marker" aria-hidden="true"></i></div>
      <div id="sydneypin" class="pin"><i class="fa fa-map-marker" aria-hidden="true"></i></div>
    </div> -->

    <center>
      <table id="buttonTable" class="button-display">
        <tr>
          <td id="bTable" class="col-1">
            <button id="addButton" onclick="addButtonPress();" class="buttonSummon mdl-button mdl-js-button mdl-button--fab mdl-button--colored">
              <i class="material-icons">add</i>
            </button>
            <button id="modelButton" onclick="" data-state="initial" class="buttons modelButton buttonSummon mdl-button mdl-js-button mdl-button--fab mdl-button--colored"></button>
            <button id="cubeButton" onclick="" data-state="initial" class="buttons modelButton buttonSummon mdl-button mdl-js-button mdl-button--fab mdl-button--colored"></button>
            <!-- <button id="modelButton" onclick="" class="buttonSummon mdl-button mdl-js-button mdl-button--fab mdl-button--colored" style="background-image: url(assets/images/model-icon.png) !important;">
              <i class="material-icons"></i>
            </button> -->

            <!-- <button onclick="addButtonPress()" class="buttonSummon mdl-button mdl-js-button mdl-button--fab mdl-button--colored add-button-align" style="background-image: url(assets/images/model-icon.png);">
              <i class="material-icons"><img alt="Models" src="assets/images/model-icon.png"/></i>
            </button> -->

            <!-- <button onclick="addButtonPress()" class="buttonSummon mdl-button mdl-js-button mdl-button--fab mdl-button--colored add-button-align">
              <i class="material-icons"><img alt="Models" src="assets/images/model-icon.png"/></i>
            </button> -->
            <!-- <td><button onclick="removeButtonPress()" type="button">Remove</button></td> -->
          </td>
        </tr>
      </table>
    </center>
    <a-scene physics-world="gravity: 0 -9.81 0" networked-scene="
      app: myApp;
      room: room1;
      debug: true;
    ">
    <!-- <ar-scene physics-world="gravity: 0 -9.81 0" networked-scene="
      app: myApp;
      room: room1;
      debug: true;
    "> -->
      <a-assets>
        <img id="grid" src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png" crossorigin="anonymous">
        <img id="sky" src="assets/images/sky.png">
        <!-- <img id="buzzpin" src="assets/images/buzz-pin.png"> -->

        <a-asset-item id="pokemon-mtl"
                      src="https://raw.githubusercontent.com/argonjs/understanding-argon-twine/master/docs/models/pokemon-go/pokemon-go.mtl">
        </a-asset-item>

        <a-asset-item id="pokemon-obj"
                      src="https://raw.githubusercontent.com/argonjs/understanding-argon-twine/master/docs/models/pokemon-go/pokemon-go.obj">
        </a-asset-item>

        <script id="avatar-template" type="text/html">
          <a-entity class="avatar">
            <a-sphere class="head"
              scale="0.45 0.5 0.4"
              random-color
            ></a-sphere>
            <a-entity class="face"
              position="0 0.05 0"
            >
              <a-sphere class="eye"
                color="#efefef"
                position="0.16 0.1 -0.35"
                scale="0.12 0.12 0.12"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
              <a-sphere class="eye"
                color="#efefef"
                position="-0.16 0.1 -0.35"
                scale="0.12 0.12 0.12"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
            </a-entity>
          </a-entity>
        </script>

      </a-assets>
      <!-- <a-sky src="#sky"></a-sky> -->

      <a-entity id="player" networked="template:#avatar-template;showLocalTemplate:false;" camera position="0 1.3 0" wasd-controls look-controls>
                <a-entity cursor id="cursor"
                  geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.016"
                  material="color: #EEE"
                  position="0 0 -1"></a-entity>
      </a-entity>

      <a-entity position="0 0 0"
          geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0"
          material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;"></a-entity>

      <a-sky src="#sky" rotation="0 -90 0"></a-sky>


      <!-- <ar-geopose id="GT" lla="-84.394539 33.772501" userotation="false">
         <a-entity fixedsize="20" billboard>
           <a-plane rotation="0 0 0" width="2.9" height="4" src="#buzzpin" transparent="true" ></a-plane>
           <a-entity css-object="div: #gtdiv" scale="0.02 0.02 0.02" position="0 4 0" showdistance="Tech Tower @ Georgia Tech<br>Atlanta, GA, USA<br>It is "></a-entity>
        </a-entity>
      </ar-geopose>
      <ar-geopose id="London" lla="-0.076057 51.507953" userotation="false">
         <a-entity fixedsize="20" billboard>
           <a-entity css-object="div: #londonpin" scale="0.05 0.05 0.05" position="0 0 0"></a-entity>
           <a-entity css-object="div: #londondiv" scale="0.02 0.02 0.02" position="0 3 0" showdistance="The Tower of London<br>London, England<br>It is "></a-entity>
        </a-entity>
      </ar-geopose>
      <ar-geopose id="Sydney" lla="151.215286 -33.856900" userotation="false">
         <a-entity fixedsize="20" billboard>
           <a-entity css-object="div: #sydneypin" scale="0.05 0.05 0.05" position="0 0 0"></a-entity>
           <a-entity css-object="div: #sydneydiv" scale="0.02 0.02 0.02" position="0 3 0" showdistance="Sydney Opera House<br>Sydney, Australia<br>It is "></a-entity>
        </a-entity>
      </ar-geopose>
      <ar-geopose id="Tokyo" lla=" 139.752797 35.685138" userotation="false">
         <a-entity fixedsize="20" billboard>
           <a-entity css-object="div: #tokyopin" scale="0.05 0.05 0.05" position="0 0 0"></a-entity>
           <a-entity css-object="div: #tokyodiv" scale="0.02 0.02 0.02" position="0 3 0" showdistance="Imperial Palace<br>Tokyo, Japan<br>It is "></a-entity>
        </a-entity>
      </ar-geopose> -->


    <!-- </ar-scene> -->
    </a-scene>

    <script src="js/index.js"></script>
    <script src="js/buttonHandlers.js"></script>
    <script src="js/createButtons.js"></script>
    <script src="library/jscolor.min.js"></script>
    <script type="text/javascript">
      function randomNumString() {
        var max = 3;
        var min = 0;
        return (Math.random() * (max - min) + min).toString();
      }

      document.getElementById('sky').src = "<%= base64 %>";
      window.onload = (function() {
        var randomPosition = randomNumString() + ' 0 ' + randomNumString();
        console.log(randomPosition);
        document.getElementById('player').setAttribute('position', randomPosition);
      })();
    </script>
  </body>
  </html>
